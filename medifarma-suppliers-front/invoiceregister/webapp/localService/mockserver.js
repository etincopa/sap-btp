sap.ui.define(["sap/ui/core/util/MockServer"],function(e){"use strict";var t=function(){"use strict";var e=function(){};e.findToEntity=function(e,t){var r=t.find("Schema")[0];var a=t.find("EntityType");var n=t.find("EntitySet");var i={};var o;for(o=0;o<a.length;o++){if(t.getAttribute("Namespace",r)+"."+t.getAttribute("Name",a[o])===e){i.entity=a[o];break}}for(o=0;o<n.length;o++){if(t.getAttribute("EntityType",n[o])===e){i.entitySet=n[o];break}}return i};e.getNavPropValues=function(t,r,a,n,i){var o=i.find("Association");var u=i.find("Schema")[0];var l=i.getAttribute("Namespace",u);var s;var f;for(f=0;f<o.length;f++){var c=l+"."+i.getAttribute("Name",o[f]);var p=i.getAttribute("Relationship",n);if(c&&p&&c.toLowerCase()===p.toLowerCase()){s=o[f];break}}var d=i.find("End",s);var g=false;var v;for(f=0;f<d.length;f++){var y=i.getAttribute("Role",d[f]);var h=i.getAttribute("ToRole",n);if(y&&h&&y.toLowerCase()===h.toLowerCase()){if(i.getAttribute("Multiplicity",d[f])==="*"){g=true}v=i.getAttribute("Type",d[f]);break}}var m=g?[]:null;if(n&&v){var b=e.findToEntity(v,i);var N;var A;var E;var k=t[i.getAttribute("Name",b.entitySet)];var P=i.find("ReferentialConstraint",s);k.forEach(function(e){E=true;for(f=0;f<P.length;f++){N=i.find("Principal",P[f])[0];N=i.getAttribute("Name",i.find("PropertyRef",N)[0]);A=i.find("Dependent",P[f])[0];A=i.getAttribute("Name",i.find("PropertyRef",A)[0]);if(g&&e[A]!==r[N]||!g&&r[A]!==e[N]){E=false}}if(E&&a.propertyName){if(g){m.push(e[a.propertyName])}else{m=e[a.propertyName]}}})}if(a.propertyName){m=e.removeNull(m);if(Array.isArray(m)){if(a.navPropOp==="sum"){var C=null;if(e.allNumeric(m)){C=0;for(f=0;f<m.length;f++){C+=parseFloat(m[f])}}m=C}else if(a.navPropOp==="count"){var w=0;for(f=0;f<m.length;f++){if(m[f]!==null){w++}}m=w}else if(a.navPropOp==="mean"){if(e.allNumeric(m)){var S=0;for(f=0;f<m.length;f++){S+=parseFloat(m[f])}m=S/m.length}else{m=null}}else{m=null}}}else{m=null}return m};e.getEntity=function(e,t){var r;var a=t.find("EntityType");for(var n=0;n<a.length;n++){var i=t.getAttribute("Name",a[n]);if(i&&e&&i.toLowerCase()===e.toLowerCase()){r=a[n];break}}return r};e.getProperty=function(e,t,r){var a;var n=r.find("Property",t);for(var i=0;i<n.length;i++){var o=r.getAttribute("Name",n[i]);if(o&&e&&o.toLowerCase()===e.toLowerCase()){a=n[i];break}}return a};e.getCalculatedProperties=function(t,r,a,n,i){var o=[];var u=null;var l=null;if(n.filter(function(e){var t=i.getAttribute("Name",e);var a=i.getAttribute("Name",r);var n=i.getAttribute("Name",e.parentNode);var o=i.getAttribute("Name",r.parentNode);return a&&t&&t.toLowerCase()===a.toLowerCase()&&o&&n&&n.toLowerCase()===o.toLowerCase()}).length===0&&!r.done){l=r;n.push(l)}var s=i.getAttribute("sap:calculated",r);var f=null;var c=null;if(s){s.inputProperties.forEach(function(t){f=e.getEntity(t.entityId,i);c=e.getProperty(t.propertyId,f,i);var r=i.getAttribute("sap:calculated",c);if(!t.done&&r&&r.calculation){o.push(t)}})}o.forEach(function(o){f=e.getEntity(o.entityId,i);u=e.getProperty(o.propertyId,f,i);var l=i.getAttribute("sap:calculated",u);if(n.filter(function(e){var t=i.getAttribute("Name",e);var r=i.getAttribute("Name",u);var a=i.getAttribute("Name",e.parentNode);var n=i.getAttribute("Name",u.parentNode);return t&&t.toLowerCase()===r&&r.toLowerCase()&&a&&a.toLowerCase()===n&&n.toLowerCase()}).length===0){if(l&&l.calculation){n.push(u);l.inputProperties.forEach(function(o){t=e.getEntity(o.entityId,i);r=e.getProperty(o.propertyId,t,i);var u=i.getAttribute("sap:calculated",r);if(u&&u.calculation){n=e.getCalculatedProperties(t,r,a,n,i)}})}}});return n};e.allNumeric=function(e){var t=new RegExp("^-?[0-9]+\\.?[0-9]*$|^-?[0-9]*\\.[0-9]+$");var r=true;if(Array.isArray(e)){for(var a=0;a<e.length;a++){if(!t.test(e[a])&&e[a]!==null&&e[a]!==undefined){r=false}}}else{r=!(!t.test(e)&&e!==null&&e!==undefined)}return r};e.removeNull=function(t){var r=e.allNumeric(t);if(Array.isArray(t)){for(var a=0;a<t.length;a++){if(t[a]===null||t[a]===undefined){if(r){t[a]=0}else{t[a]=""}}}}else{if(t===null||t===undefined){t=0}}return t};e.generateResult=function(t,r,a,n,i){var o;switch(t[0].type){case"condition":if(e.generateResult(t[0].condition,r,a,n,i)){o=e.generateResult(t[0].then,r,a,n,i)}else if(t[0].else.length>0){o=e.generateResult(t[0].else,r,a,n,i)}else{o=""}break;case"operator":var u=null;if(t[0].hasOwnProperty("left")){u=e.generateResult(t[0].left,r,a,n,i)}var l=e.generateResult(t[0].right,r,a,n,i);u=e.removeNull(u);l=e.removeNull(l);if(!u&&typeof l==="string"){u=""}else if(!l&&typeof u==="string"){l=""}if(!Array.isArray(l)&&!Array.isArray(u)){if(e.allNumeric(u)){u=parseFloat(u)}if(e.allNumeric(l)){l=parseFloat(l)}switch(t[0].name){case"plus":o=u+l;break;case"minus":o=u-l;break;case"times":o=u*l;break;case"divide":o=u/l;break;case"ltoe":o=u<=l;break;case"lt":o=u<l;break;case"gtoe":o=u>=l;break;case"gt":o=u>l;break;case"and":o=u&&l;break;case"or":o=u||l;break;case"equals":o=u===l;break;case"different":o=u!==l;break;case"isNull":o=!l;break;default:o=null}}else{o=null}break;case"property":var s=i.getAttribute("Name",n);if(t[0].navPropId){var f;var c=i.find("NavigationProperty",n);for(var p=0;p<c.length;p++){var d=i.getAttribute("Name",c[p]);if(t[0].navPropName&&d&&d.toLowerCase()===t[0].navPropName.toLowerCase()){f=c[p];break}}o=null||f&&e.getNavPropValues(r,a,t[0],f,i)}else if(t[0].entityName&&s&&t[0].entityName.toLowerCase()===s.toLowerCase()){if(!e.allNumeric(a[t[0].propertyName])){o=a[t[0].propertyName]}else{o=parseFloat(a[t[0].propertyName])}}break;case"value":o=e.parseFormulaValue(t[0].computedType,t[0].value);break;default:o=null||t[0]}o=e.removeNull(o);return o};e.parseFormulaValue=function(e,t,r){var a,n=false;if(!e){return t}if(e==="number"){a=parseFloat(t);n=!isNaN(a);if(n){t=a}}else if(e==="boolean"){n=typeof t==="boolean";if(!n){n=t&&typeof t==="string";if(n){a=t.toLowerCase().trim();if(a==="true"){t=true}else if(a==="false"){t=false}else{n=false;t=undefined}}}}else if(e==="string"){n=t&&t.toString;if(n){t=t.toString()}}else if(e==="datetime"||e==="time"||e==="datetimeoffset"){n=t&&t.toString;if(n){t=t.toString()}}return!n&&r?undefined:t};e.getNameSet=function(e,t){var r;var a=t.getAttribute("Namespace",t.find("Schema")[0]);var n=t.find("EntitySet");for(var i=0;i<n.length;i++){if(t.getAttribute("EntityType",n[i])===a+"."+e){r=t.getAttribute("Name",n[i]);break}}return r};e.calcLeft=function(e){var t=0;for(var r=0;r<e.length;r++){if(!e[r].done){t++}}return t};e.calculateValues=function(t,r,a,n){var i=r[e.getNameSet(n.getAttribute("Name",t),n)];if(a.length>0){var o=function(t){var a=e.getEntity(t.entityId,n);var i=e.getProperty(t.propertyId,a,n);if(n.getAttribute("sap:calculated",i)){var o=e.getCalculatedProperties(a,i,r,[],n);e.calculateValues(a,r,o,n)}};for(var u=0;u<a.length;u++){if(!a[u].done){var l=n.getAttribute("sap:calculated",a[u]);var s=n.getAttribute("sap:calculated",a[u]).inputProperties;var f;for(f=0;f<s.length;f++){var c=e.getEntity(s[f].entityId,n);s[f]=e.getProperty(s[f].propertyId,c,n)}if(l.inputProperties.length===0||e.noCalcProp(l.inputProperties,a,n)){for(f=0;f<i.length;f++){var p;try{p=e.generateResult(l.calculation,r,i[f],t,n);p=e.parseFormulaValue(l.calculation[0].computedType,p,true)}catch(e){if(jQuery&&jQuery.sap&&jQuery.sap.log){jQuery.sap.log.error(e)}p=null}a[u].done=true;i[f][n.getAttribute("Name",a[u])]=p}if(!f){a[u].done=true}}else if(e.calcLeft(s)){if(!a[u].beenThrough&&!a[u].circular){a[u].beenThrough=true;l.inputProperties.forEach(o)}else{a[u].done=true;a[u].circular=true;var d=n.getAttribute("Name",a[u]);for(f=0;f<i.length;f++){i[f][d]="Circularity Error in "+d}}}if(e.calcLeft(a)){e.calculateValues(a[u].parentNode,r,a,n)}}}}return i};e.noCalcProp=function(e,t,r){var a=true;e.forEach(function(e){for(var n=0;n<t.length;n++){var i=r.getAttribute("Name",t[n]);var o=r.getAttribute("Name",t[n].parentNode);if(i&&e.propertyId&&i.toLowerCase()===e.propertyId.toLowerCase()&&o&&e.entityId&&o.toLowerCase()===e.entityId.toLowerCase()&&!t[n].done){a=false}}});return a};e.eraseCalculatedValues=function(t,r){var a=r.find("EntityType");var n=function(e,t,a){t.forEach(function(t){if(e&&e.calculation&&t.hasOwnProperty(r.getAttribute("Name",a))){delete t[r.getAttribute("Name",a)]}})};var i;for(var o=0;o<a.length;o++){i=r.find("Property",a[o]);for(var u=0;u<i.length;u++){if(i[u].done){i[u].done=false}var l=r.getAttribute("sap:calculated",i[u]);var s=t[e.getNameSet(r.getAttribute("Name",a[o]),r)]||[];n(l,s,i[u])}}};e.resetCircularity=function(e){for(var t=0;t<e.length;t++){if(e[t].beenThrough){e[t].beenThrough=false}}};e.calculateData=function(t,r,a){var n=[];var i=a.find("Property",t);for(var o=0;o<i.length;o++){var u=a.getAttribute("sap:calculated",i[o]);if(u&&u.calculation){n=e.getCalculatedProperties(t,i[o],r,n,a)}}e.resetCircularity(n);return e.calculateValues(t,r,n,a)};e.getEntityData=function(t,r){var a=r.find("EntityType");e.eraseCalculatedValues(t,r);for(var n=0;n<a.length;n++){e.calculateData(a[n],t,r)}};e.patchRequester=function(t,r){var a=[],n=true,i=t;t.getRequests().forEach(function(t){if(t.method==="POST"){if(n){n=false;a.push(t)}else{a.push({method:t.method,path:t.path,response:function(a,n,o,u,l){if(a.requestHeaders["x-http-method"]==="MERGE"){return r.sap.sjax({type:"MERGE",url:a.url,data:a.requestBody})}var s=jQuery.extend({},a);s.respond=function(){e.getEntityData(i._oMockdata,r);a.respond.apply(a,arguments)};t.response(s,n,o,u,l)}})}}else if(t.method==="MERGE"){a.push({method:t.method,path:t.path,response:function(a,n,o,u){var l=jQuery.extend({},a);l.respond=function(){e.getEntityData(i._oMockdata,r);a.respond.apply(a,arguments)};t.response(l,n,o,u)}})}else if(t.method==="PUT"){a.push({method:t.method,path:t.path,response:function(a,n,o,u){var l=jQuery.extend({},a);l.respond=function(){e.getEntityData(i._oMockdata,r);a.respond.apply(a,arguments)};t.response(l,n,o,u)}})}else if(t.method==="DELETE"){a.push({method:t.method,path:t.path,response:function(a,n,o,u){var l=jQuery.extend({},a);l.respond=function(){e.getEntityData(i._oMockdata,r);a.respond.apply(a,arguments)};t.response(l,n,o,u)}})}else{a.push(t)}});t.setRequests(a)};e.patchODataSelect=function(e){e._getOdataQuerySelect=function(e,t){var r=this;var a,n;var i=t.split(",");var o=[];var u;var l=function(e,t,r){if(t.__metadata){r.__metadata=t.__metadata}jQuery.each(e,function(e,i){var o=i.indexOf("/");if(o!==-1){a=i.substring(o+1);n=i.substring(0,o);if(!r[n]){r[n]={}}r[n]=l([a],t[n],r[n])}else{if(t&&!t.hasOwnProperty(i)){t[i]=""}r[i]=t[i]}});return r};if(jQuery.inArray("*",i)!==-1){return e}jQuery.each(i,function(e,t){i[e]=r._trim(t)});jQuery.each(e,function(e,t){u={};o.push(l(i,t,u))});return o}};e.patchMockServer=function(t){var r={currMockServer:t,find:function(e,t){if(typeof t==="undefined"){t=this.currMockServer._oMetadata}return jQuery(t).find(e)},getAttribute:function(e,t){var r;if(e==="sap:calculated"){r=t.getAttribute("sap:calculated");if(r){r=JSON.parse(t.getAttribute("sap:calculated"));if(r.calculation){r.calculation=JSON.parse(r.calculation)}}}else{r=t.getAttribute(e)}return r}};t.calculated=function(){e.getEntityData(r.currMockServer._oMockdata,r)};e.getEntityData(t._oMockdata,r);e.patchRequester(t,r);e.patchODataSelect(t)};return e}();var r,a="com.everis.suppliers.invoiceregister/";return{init:function(){var e=jQuery.sap.getModulePath(a+"manifest",".json"),t=jQuery.sap.syncGetJSON(e).data,r=t["sap.app"].dataSources;for(var n in r){if(r[n].type==="OData"){this.createMockServer(r,n)}}},createMockServer:function(n,i){var o=jQuery.sap.getUriParameters(),u=o.get("errorEntitySet"),l=o.get("errorType"),s=l==="badRequest"?400:500,f=n[i],c=jQuery.sap.getModulePath(a+f.settings.localUri.replace(".xml",""),".xml"),p=c.slice(0,c.lastIndexOf("/")+1),d=/.*\/$/.test(f.uri)?f.uri:f.uri+"/",g=f.settings.annotations||[];r=new e({rootUri:d});e.config({autoRespond:true,autoRespondAfter:o.get("serverDelay")||1e3});r.simulate(c,{sMockdataBaseUrl:p,bGenerateMissingMockData:true});if(typeof t!=="undefined"){t.patchMockServer(r)}var v=r.getRequests(),y=function(e,t,r){r.response=function(r){r.respond(e,{"Content-Type":"text/plain;charset=utf-8"},t)}};if(o.get("metadataError")){v.forEach(function(e){if(e.path.toString().indexOf("$metadata")>-1){y(500,"metadata Error",e)}})}if(l){v.forEach(function(e){if(e.path.toString().indexOf(u)>-1){y(s,l,e)}})}r.start();jQuery.sap.log.info("Running the app with mock data");g.forEach(function(t){var r=n[t],i=r.uri,o=jQuery.sap.getModulePath(a+r.settings.localUri.replace(".xml",""),".xml");new e({rootUri:i,requests:[{method:"GET",path:new RegExp(""),response:function(e){jQuery.sap.require("jquery.sap.xml");var t=jQuery.sap.sjax({url:o,dataType:"xml"}).data;e.respondXML(200,{},jQuery.sap.serializeXML(t));return true}}]}).start()})}}});