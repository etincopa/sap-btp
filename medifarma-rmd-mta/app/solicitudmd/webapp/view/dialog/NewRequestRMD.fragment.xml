<core:FragmentDefinition 
    xmlns="sap.m" 
    xmlns:core="sap.ui.core" 
    xmlns:form="sap.ui.layout.form" 
    xmlns:simple="sap.gantt.simple"
    xmlns:layout="sap.ui.layout"
    xmlns:u="sap.ui.unified"
>
	<Dialog title="{i18n>titleNewRequestRMD}" class="sapUiContentPadding sapUiSizeCompact" contentWidth="65%" draggable="true">
		<content>
			<form:Form width="100%" editable="true" visible="true">
                <form:formContainers>
                    <form:FormContainer visible="true">
                        <form:formElements>
                            <form:FormElement visible="true">
                                <form:label>
                                    <Label text="" design="Bold" width="100%" required="true" textAlign="Begin" textDirection="Inherit"/>
                                </form:label>
                                <form:fields>
                                    <RadioButtonGroup id="rbg" columns="2" selectedIndex="0" class="sapUiMediumMarginBottom" select="onChangeRdb">
                                        <RadioButton id="0" text="{i18n>rdbRmd}" />
                                        <RadioButton id="1" text="{i18n>rdbVersion}" />
                                    </RadioButtonGroup>
                                </form:fields>
                            </form:FormElement>
                            <form:FormElement visible="{new>/state}">
                                <form:label>
                                <Label text="{i18n>lblName}" vAlign="Middle" design="Bold" width="100%" required="true" textAlign="Begin" textDirection="Inherit"/>
                                </form:label>
                                <form:fields>
                                <Input value="{modelGeneral>/newRMD/descripcion}" placeholder="{i18n>phlblName}" type="Text" showValueHelp="false" visible="true"
                                    width="100%" valueHelpOnly="false"/>
                                </form:fields>
                            </form:FormElement>
                            <form:FormElement visible="{new>/state}">
                                <form:label>
                                <Label text="{i18n>lblPlant}" vAlign="Middle" design="Bold" width="100%" required="true" textAlign="Begin" textDirection="Inherit"/>
                                </form:label>
                                <form:fields>
                                <ComboBox items="{
                                    path : 'mainModel>/MAESTRA',
                                    filters: [{
                                            path: 'oMaestraTipo_maestraTipoId',
                                            operator: 'EQ',
                                            value1: '18'
                                        }]
                                        }" 
                                    placeholder="{i18n>phlblPlant}" selectedKey="{modelGeneral>/newRMD/sucursalId}"
                                    showSecondaryValues="true" filterSecondaryValues="true">
                                    <core:ListItem key="{mainModel>iMaestraId}" text="{mainModel>contenido}" additionalText="{mainModel>codigo}"/>
                                </ComboBox>
                                </form:fields>
                            </form:FormElement>
                            <form:FormElement visible="{new>/state}">
                                <form:label>
                                <Label text="{i18n>lblSection}" vAlign="Middle" design="Bold" width="100%" required="true" textAlign="Begin" textDirection="Inherit"/>
                                </form:label>
                                <form:fields>
                                <ComboBox items="{modelGeneral>/aListaSecciones}" placeholder="{i18n>phlblSection}" selectedKey="{modelGeneral>/newRMD/areaRmdTxt}"
                                    showSecondaryValues="true" filterSecondaryValues="true">
                                    <core:ListItem key="{modelGeneral>Atwrt}" text="{modelGeneral>Atwrt}" additionalText="{modelGeneral>Atzhl}"/>
                                </ComboBox>
                                </form:fields>
                            </form:FormElement>
                            <form:FormElement visible="{new>/state}">
                                <form:label>
                                <Label text="{i18n>lblReason}" vAlign="Middle" design="Bold" width="100%" required="true" textAlign="Begin" textDirection="Inherit"/>
                                </form:label>
                                <form:fields>
                                    <ComboBox items="{
                                    path : 'mainModel>/MOTIVO',
                                    filters: [{
                                            path: 'activo',
                                            operator: 'EQ',
                                            value1: 'true'
                                        }]
                                        }" 
                                    placeholder="{i18n>phlblReason}" selectedKey="{modelGeneral>/newRMD/motivoId}"
                                    showSecondaryValues="true" filterSecondaryValues="true">
                                    <core:ListItem key="{mainModel>motivoId}" text="{mainModel>descripcion}" additionalText="{mainModel>abreviatura}"/>
                                    </ComboBox>
                                </form:fields>
                            </form:FormElement>
                            <form:FormElement visible="{new>/state}">
                                <form:label>
                                <Label text="{i18n>lblObservation}" vAlign="Middle" design="Bold" width="100%" textAlign="Begin" textDirection="Inherit"/>
                                </form:label>
                                <form:fields>
                                <Input value="{modelGeneral>/newRMD/observacion}" placeholder="{i18n>phlblObservation}" type="Text" showValueHelp="false" visible="true"
                                    width="100%" valueHelpOnly="false"/>
                                </form:fields>
                            </form:FormElement>
                            <form:FormElement visible="{new>/state}">
                                <form:label>
                                <Label text="{i18n>lblDestinations}" vAlign="Middle" design="Bold" width="100%" required="true" textAlign="Begin" textDirection="Inherit"/>
                                </form:label>
                                <form:fields>
                                <MultiComboBox 
                                    items="{
                                        path: 'modelGeneral>/destinations',
                                        sorter: {
                                            path: 'modelGeneral>rol',
                                            descending: false,
                                            group: true
                                        }
                                    }"
                                    selectedKeys="{modelGeneral>/newRMD/destinatarios}"
                                    showSecondaryValues="true" id="idDestinatariosNew" editable="false">
                                    <core:ListItem key="{modelGeneral>usuarioId}" text="{modelGeneral>usuario} - {modelGeneral>nombre}"/>
                                </MultiComboBox>
                                </form:fields>
                            </form:FormElement>
                            <form:FormElement visible="{new>/state}">
                                <form:label>
                                    <Label text="Etapa" vAlign="Middle" design="Bold" width="100%" required="true" textAlign="Begin" textDirection="Inherit"/>
                                </form:label>
                                <form:fields>
                                    <ComboBox items="{modelGeneral>/aListaNiveles}" placeholder="Seleccione etapa" selectedKey="{modelGeneral>/newRMD/nivelTxt}"
                                    showSecondaryValues="true" filterSecondaryValues="true">
                                    <core:ListItem key="{modelGeneral>Atwrt}" text="{modelGeneral>Atwrt}" additionalText="{modelGeneral>Atzhl}"/>
                                    </ComboBox>
                                </form:fields>
                            </form:FormElement>
                            <form:FormElement visible="{new>/state}">
                                <form:label>
                                <Label text="{i18n>lblAdjunt}" vAlign="Middle" design="Bold" width="100%" required="true" textAlign="Begin" textDirection="Inherit"/>
                                </form:label>
                                <form:fields>
                                    <Table items="{modelGeneral>/newRMD/adjuntos}">
                                        <headerToolbar>
                                            <OverflowToolbar>
                                                <content>
                                                    <ToolbarSpacer />
                                                    <u:FileUploader id="fileUploader2" tooltip="{i18n>tltpAdjunt}" uploadOnChange="true" change="handleUploadComplete" icon="sap-icon://upload" iconOnly="true" buttonOnly="true"/>
                                                </content>
                                            </OverflowToolbar>
                                        </headerToolbar>
                                        <columns>
                                            <Column
                                                width="3em">
                                                <Text text="" />
                                            </Column>
                                            <Column>
                                                <Text text="Nombre" />
                                            </Column>
                                            <Column hAlign="End">
                                                <Text text=""/>
                                            </Column>
                                        </columns>
                                        <items>
                                            <ColumnListItem>
                                                <cells>
                                                    <core:Icon src="sap-icon://pdf-attachment"/>
                                                    <Text text="{modelGeneral>Name}"/>
                                                    <Button icon="sap-icon://decline" type="Transparent" press="onEliminarNewAdjunto"/>
                                                </cells>
                                            </ColumnListItem>
                                        </items>
                                    </Table>
                                </form:fields>
                            </form:FormElement>
                            <form:FormElement visible="{version>/state}">
                                <form:label>
                                <Label text="Material" vAlign="Middle" design="Bold" width="100%" required="true" textAlign="Begin" textDirection="Inherit"/>
                                </form:label>
                                <form:fields>
                                <ComboBox items="{path : 'modelGeneral>/RECETA', length:99999999}" placeholder="Seleccione Material" change="onSelectMaterial"
                                    showSecondaryValues="true" filterSecondaryValues="true" selectedKey="{modelGeneral>/newVersionRMD/recetaSelected}">
                                    <core:ListItem key="{modelGeneral>recetaId}" text="{modelGeneral>Text1}" additionalText="{modelGeneral>Verid}"/>
                                </ComboBox>
                                </form:fields>
                            </form:FormElement>
                            <form:FormElement visible="{version>/state}">
                                <form:label>
                                <Label text="{i18n>lblNewRmd}" vAlign="Middle" design="Bold" width="100%" required="true" textAlign="Begin" textDirection="Inherit"/>
                                </form:label>
                                <form:fields>
                                <ComboBox id="idCodigoMaterial" items="{path : 'modelGeneral>/mdAsociadas'}" placeholder="{i18n>phlblNewRmd}" selectedKey="{modelGeneral>/newVersionRMD/mdId}"
                                    showSecondaryValues="true" filterSecondaryValues="true" change="onSelectRMDToVersion" editable="{=${modelGeneral>/mdAsociadas}.length > 0 ? true : false}">
                                    <core:ListItem key="{modelGeneral>mdId}" text="{modelGeneral>descripcion}" additionalText="{modelGeneral>codigo}"/>
                                </ComboBox>
                                </form:fields>
                            </form:FormElement>
                            <form:FormElement visible="{version>/state}">
                                <form:label>
                                <Label text="{i18n>lblPlant}" vAlign="Middle" design="Bold" width="100%" required="true" textAlign="Begin" textDirection="Inherit"/>
                                </form:label>
                                <form:fields>
                                <ComboBox items="{
                                    path : 'mainModel>/MAESTRA',
                                    filters: [{
                                            path: 'oMaestraTipo_maestraTipoId',
                                            operator: 'EQ',
                                            value1: '18'
                                        }]
                                        }" 
                                    placeholder="{i18n>phlblPlant}" selectedKey="{modelGeneral>/newVersionRMD/sucursalId_iMaestraId}"
                                    showSecondaryValues="true" filterSecondaryValues="true" editable="false">
                                    <core:ListItem key="{mainModel>iMaestraId}" text="{mainModel>contenido}" additionalText="{mainModel>codigo}"/>
                                </ComboBox>
                                </form:fields>
                            </form:FormElement>
                            <form:FormElement visible="{version>/state}">
                                <form:label>
                                <Label text="{i18n>lblSection}" vAlign="Middle" design="Bold" width="100%" required="true" textAlign="Begin" textDirection="Inherit"/>
                                </form:label>
                                <form:fields>
                                <ComboBox items="{modelGeneral>/aListaSecciones}" placeholder="{i18n>phlblSection}" selectedKey="{modelGeneral>/newVersionRMD/areaRmdTxt}"
                                    showSecondaryValues="true" filterSecondaryValues="true" editable="false">
                                    <core:ListItem key="{modelGeneral>Atwrt}" text="{modelGeneral>Atwrt}" additionalText="{modelGeneral>Atzhl}"/>
                                </ComboBox>
                                </form:fields>
                            </form:FormElement>
                            <form:FormElement visible="{version>/state}">
                                <form:label>
                                <Label text="{i18n>lblReason}" vAlign="Middle" design="Bold" width="100%" required="true" textAlign="Begin" textDirection="Inherit"/>
                                </form:label>
                                <form:fields>
                                    <ComboBox items="{
                                    path : 'mainModel>/MOTIVO',
                                    filters: [{
                                            path: 'activo',
                                            operator: 'EQ',
                                            value1: 'true'
                                        }]
                                        }" 
                                    placeholder="{i18n>phlblReason}" selectedKey="{modelGeneral>/newVersionRMD/motivoId_motivoId}"
                                    showSecondaryValues="true" filterSecondaryValues="true">
                                    <core:ListItem key="{mainModel>motivoId}" text="{mainModel>descripcion}" additionalText="{mainModel>abreviatura}"/>
                                    </ComboBox>
                                </form:fields>
                            </form:FormElement>
                            <form:FormElement visible="{version>/state}">
                                <form:label>
                                <Label text="{i18n>lblObservation}" vAlign="Middle" design="Bold" width="100%" textAlign="Begin" textDirection="Inherit"/>
                                </form:label>
                                <form:fields>
                                <Input value="{modelGeneral>/newVersionRMD/observacion}" placeholder="{i18n>phlblObservation}" type="Text" showValueHelp="false" visible="true"
                                    width="100%" valueHelpOnly="false"/>
                                </form:fields>
                            </form:FormElement>
                            <form:FormElement visible="{version>/state}">
                                <form:label>
                                <Label text="{i18n>lblDestinations}" vAlign="Middle" design="Bold" width="100%" required="true" textAlign="Begin" textDirection="Inherit"/>
                                </form:label>
                                <form:fields>
                                <MultiComboBox 
                                    items="{
                                        path: 'modelGeneral>/destinations',
                                        sorter: {
                                            path: 'modelGeneral>rol',
                                            descending: false,
                                            group: true
                                        }
                                    }"
                                    selectedKeys="{modelGeneral>/newVersionRMD/destinatarios}"
                                    showSecondaryValues="true" id="idDestinatariosVersion" editable="false">
                                    <core:ListItem key="{modelGeneral>usuarioId}" text="{modelGeneral>usuario} - {modelGeneral>nombre}"/>
                                </MultiComboBox>
                                </form:fields>
                            </form:FormElement>
                            <form:FormElement visible="{version>/state}">
                                <form:label>
                                    <Label text="Etapa" vAlign="Middle" design="Bold" width="100%" required="true" textAlign="Begin" textDirection="Inherit"/>
                                </form:label>
                                <form:fields>
                                    <ComboBox items="{modelGeneral>/aListaNiveles}" placeholder="Seleccione etapa" selectedKey="{modelGeneral>/newVersionRMD/nivelTxt}"
                                    showSecondaryValues="true" filterSecondaryValues="true" editable="false">
                                    <core:ListItem key="{modelGeneral>Atwrt}" text="{modelGeneral>Atwrt}" additionalText="{modelGeneral>Atzhl}"/>
                                    </ComboBox>
                                </form:fields>
                            </form:FormElement>
                            <form:FormElement visible="{version>/state}">
                                <form:label>
                                <Label text="{i18n>lblAdjunt}" vAlign="Middle" design="Bold" width="100%" required="true" textAlign="Begin" textDirection="Inherit"/>
                                </form:label>
                                <form:fields>
                                    <Table items="{modelGeneral>/newVersionRMD/adjuntos}">
                                        <headerToolbar>
                                            <OverflowToolbar>
                                                <content>
                                                    <ToolbarSpacer />
                                                    <u:FileUploader id="fileUploader3" tooltip="{i18n>tltpAdjunt}" uploadOnChange="true" change="handleUploadCompleteVersion" icon="sap-icon://upload" iconOnly="true" buttonOnly="true"/>
                                                </content>
                                            </OverflowToolbar>
                                        </headerToolbar>
                                        <columns>
                                            <Column
                                                width="3em">
                                                <Text text="" />
                                            </Column>
                                            <Column>
                                                <Text text="Nombre" />
                                            </Column>
                                            <Column hAlign="End">
                                                <Text text=""/>
                                            </Column>
                                        </columns>
                                        <items>
                                            <ColumnListItem>
                                                <cells>
                                                    <core:Icon src="sap-icon://pdf-attachment"/>
                                                    <Text text="{modelGeneral>Name}"/>
                                                    <Button icon="sap-icon://decline" type="Transparent" press="onEliminarVersionAdjunto"/>
                                                </cells>
                                            </ColumnListItem>
                                        </items>
                                    </Table>
                                </form:fields>
                            </form:FormElement>
                        </form:formElements>
                        <form:title/>
                    </form:FormContainer>
                </form:formContainers>
                <form:layout>
                    <form:ResponsiveGridLayout adjustLabelSpan="false" columnsL="2" labelSpanL="3" columnsM="1" labelSpanM="2" labelSpanS="12"/>
                </form:layout>
            </form:Form>
        </content>
		<beginButton>
			<Button text="{i18n>btnConfirm}" press="onCreateRequest" type="Accept"/>
		</beginButton>
		<endButton>
			<Button text="{i18n>btnCancel}" press="onCancelRequest" type="Reject"/>
		</endButton>
	</Dialog>
</core:FragmentDefinition>